<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>Next主题</title>
    <url>/2024/10/05/hello-world/</url>
    <content><![CDATA[<h2 id="指路Next入门教程"><a href="#指路Next入门教程" class="headerlink" title="指路Next入门教程"></a><a href="https://hexo-next.readthedocs.io/zh-cn/latest/next/">指路Next入门教程</a></h2>]]></content>
      <categories>
        <category>Hexo-Next</category>
      </categories>
      <tags>
        <tag>Beautify</tag>
      </tags>
  </entry>
  <entry>
    <title>compiler impletment learn from Jack W. Crenshaw</title>
    <url>/2024/10/26/compiler-impletment-learn-from-Jack-W-Crenshaw/</url>
    <content><![CDATA[<p>(教程连接)[<a href="https://compilers.iecc.com/crenshaw/]">https://compilers.iecc.com/crenshaw/]</a></p>
<h1 id="阶段1-Single-Num-expression"><a href="#阶段1-Single-Num-expression" class="headerlink" title="阶段1 Single Num expression"></a>阶段1 Single Num expression</h1><h2 id="只含”-“的二元表达式"><a href="#只含”-“的二元表达式" class="headerlink" title="只含”+-“的二元表达式"></a>只含”+-“的二元表达式</h2><figure class="highlight pascal"><table><tr><td class="code"><pre><span class="line"><span class="comment">&#123;</span></span><br><span class="line"><span class="comment">    expr::= term&lt;+-term&gt;</span></span><br><span class="line"><span class="comment">    term::=GetNum</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">&#123;-------------------------------------------------------------&#125;</span></span><br><span class="line"><span class="function"><span class="keyword">procedure</span> <span class="title">Expression</span>;</span></span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">    Term;<span class="comment">&#123;MOVE #GetNum,D0;&#125;</span></span><br><span class="line">    EmitLn(<span class="string">&#x27;MOVE D0,D1&#x27;</span>);</span><br><span class="line">    <span class="keyword">case</span> Look <span class="keyword">of</span></span><br><span class="line">    <span class="string">&#x27;+&#x27;</span>: Add;<span class="comment">&#123;Match(&#x27;+&#x27;);Term;ADD D1,D0;结果存在D0&#125;</span></span><br><span class="line">    <span class="string">&#x27;-&#x27;</span>: Substract;<span class="comment">&#123;Match(&#x27;-&#x27;);Term;SUB D1,D0;NEG D0;结果存在D0&#125;</span></span><br><span class="line">    <span class="keyword">else</span> Expected(<span class="string">&#x27;加减操作符&#x27;</span>);</span><br><span class="line"><span class="keyword">end</span>;</span><br></pre></td></tr></table></figure>
<h2 id="多个操作数"><a href="#多个操作数" class="headerlink" title="多个操作数"></a>多个操作数</h2><figure class="highlight pascal"><table><tr><td class="code"><pre><span class="line"><span class="comment">&#123;循环解决,将数压栈解决寄存器有限&#125;</span></span><br><span class="line"><span class="comment">&#123;-------------------------------------------------------------&#125;</span></span><br><span class="line"><span class="function"><span class="keyword">procedure</span> <span class="title">Expression</span>;</span></span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">    Term;<span class="comment">&#123;MOVE #GetNum,D0;&#125;</span></span><br><span class="line">    <span class="keyword">while</span> Look <span class="keyword">in</span> [<span class="string">&#x27;+&#x27;</span>,<span class="string">&#x27;-&#x27;</span>] <span class="keyword">do</span> <span class="keyword">begin</span></span><br><span class="line">        EmitLn(<span class="string">&#x27;MOVE D0,-(SP)&#x27;</span>);<span class="comment">&#123;D1=D0;&#125;</span></span><br><span class="line">        <span class="keyword">case</span> Look <span class="keyword">of</span></span><br><span class="line">        <span class="string">&#x27;+&#x27;</span>: Add;<span class="comment">&#123;Match(&#x27;+&#x27;);Term; ADD (SP)+,D0;&#125;</span></span><br><span class="line">        <span class="string">&#x27;-&#x27;</span>: Substract;<span class="comment">&#123;Match(&#x27;-&#x27;);Term; SUB -(SP),D0; NEG D0 ;&#125;</span></span><br><span class="line">        <span class="keyword">else</span> Expected(<span class="string">&#x27;加减操作符&#x27;</span>);</span><br><span class="line">        <span class="keyword">end</span>;</span><br><span class="line">    <span class="keyword">end</span>;</span><br><span class="line"><span class="keyword">end</span>;</span><br></pre></td></tr></table></figure>
<h2 id="增加”-“"><a href="#增加”-“" class="headerlink" title="增加”*&#x2F;“"></a>增加”*&#x2F;“</h2><figure class="highlight oxygene"><table><tr><td class="code"><pre><span class="line"><span class="comment">&#123;</span></span><br><span class="line"><span class="comment">    优先级高，单位更小</span></span><br><span class="line"><span class="comment">    expr::= term &lt;+- term&gt;</span></span><br><span class="line"><span class="comment">    term::= factor &lt;*/ factor&gt;</span></span><br><span class="line"><span class="comment">    factor::= GetNum</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">&#123;------------------------------------------------------------&#125;</span></span><br><span class="line"><span class="keyword">procedure</span> <span class="title function_">Expression</span>;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">    Term<span class="punctuation">;</span></span><br><span class="line">    <span class="keyword">while</span> Look <span class="keyword">in</span> [<span class="string">&#x27;+&#x27;</span>,<span class="string">&#x27;-&#x27;</span>] <span class="keyword">do</span> <span class="keyword">begin</span></span><br><span class="line">        EmitLn(<span class="string">&#x27;MOVE D0,-(SP)&#x27;</span>)<span class="punctuation">;</span><span class="comment">&#123;压栈&#125;</span></span><br><span class="line">        <span class="keyword">case</span> Look <span class="keyword">of</span></span><br><span class="line">        <span class="string">&#x27;+&#x27;</span>: <span class="keyword">Add</span><span class="punctuation">;</span><span class="comment">&#123;Match(&#x27;+&#x27;);Term; ADD (SP)+,D0;&#125;</span></span><br><span class="line">        <span class="string">&#x27;-&#x27;</span>: Substract<span class="punctuation">;</span><span class="comment">&#123;Match(&#x27;-&#x27;);Term; SUB (SP)-,D0; NEG D0;&#125;</span></span><br><span class="line">        <span class="keyword">else</span> Expected(<span class="string">&#x27;加减操作符&#x27;</span>)<span class="punctuation">;</span></span><br><span class="line">        <span class="keyword">end</span><span class="punctuation">;</span></span><br><span class="line">    <span class="keyword">end</span><span class="punctuation">;</span></span><br><span class="line"><span class="keyword">end</span><span class="punctuation">;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">procedure</span> <span class="title function_">Term</span>;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">    Factor<span class="punctuation">;</span><span class="comment">&#123;GetNum;&#125;</span></span><br><span class="line">    <span class="keyword">while</span> Look <span class="keyword">in</span> [<span class="string">&#x27;*&#x27;</span>,<span class="string">&#x27;/&#x27;</span>] <span class="keyword">do</span> <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">case</span> Look <span class="keyword">of</span></span><br><span class="line">        <span class="string">&#x27;*&#x27;</span>: Multiply<span class="punctuation">;</span><span class="comment">&#123;Match(&#x27;*&#x27;);Factor;MUL (SP)+,D0;&#125;</span></span><br><span class="line">        <span class="string">&#x27;/&#x27;</span>: Divide<span class="punctuation">;</span></span><br><span class="line">        <span class="keyword">else</span> Expected(<span class="string">&#x27;乘除操作符&#x27;</span>)<span class="punctuation">;</span></span><br><span class="line">    <span class="keyword">end</span><span class="punctuation">;</span></span><br><span class="line"><span class="keyword">end</span><span class="punctuation">;</span></span><br></pre></td></tr></table></figure>
<h2 id="增加”-”"><a href="#增加”-”" class="headerlink" title="增加”()”"></a>增加”()”</h2><figure class="highlight pascal"><table><tr><td class="code"><pre><span class="line"><span class="comment">&#123;</span></span><br><span class="line"><span class="comment">    递归</span></span><br><span class="line"><span class="comment">    factor ::= (expr) or GetNum</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">&#123;------------------------------&#125;</span></span><br><span class="line"><span class="function"><span class="keyword">procedure</span> <span class="title">Factor</span>;</span></span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">if</span> Look =<span class="string">&#x27;(&#x27;</span> than <span class="keyword">begin</span></span><br><span class="line">        Match(<span class="string">&#x27;(&#x27;</span>);</span><br><span class="line">        Expression;</span><br><span class="line">        Match(<span class="string">&#x27;)&#x27;</span>);</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        EmitLn(<span class="string">&#x27;MOVE&#x27;</span>+#GetNum+<span class="string">&#x27;,D0&#x27;</span>);</span><br><span class="line"><span class="keyword">end</span>;</span><br></pre></td></tr></table></figure>

<h2 id="增加”-作为正负号的数”"><a href="#增加”-作为正负号的数”" class="headerlink" title="增加”-+作为正负号的数”"></a>增加”-+作为正负号的数”</h2><p>增加0-</p>
<figure class="highlight oxygene"><table><tr><td class="code"><pre><span class="line"><span class="comment">&#123;</span></span><br><span class="line"><span class="comment">    expr::=- or term&lt;+-term&gt;</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">&#123;------------------------------------------------------------&#125;</span></span><br><span class="line"><span class="keyword">procedure</span> <span class="title function_">Expression</span>;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">if</span> Look <span class="keyword">in</span> [<span class="string">&#x27;+&#x27;</span>,<span class="string">&#x27;-&#x27;</span>] <span class="keyword">do</span></span><br><span class="line">        EmitLn(<span class="string">&#x27;CLR D0&#x27;</span>)<span class="punctuation">;</span><span class="comment">&#123;D0=0;&#125;</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        term<span class="punctuation">;</span></span><br><span class="line">    <span class="keyword">while</span> Look <span class="keyword">in</span> [<span class="string">&#x27;+&#x27;</span>,<span class="string">&#x27;-&#x27;</span>] <span class="keyword">do</span> <span class="keyword">begin</span></span><br><span class="line">        EmitLn(<span class="string">&#x27;MOVE D0,-(SP)&#x27;</span>)<span class="punctuation">;</span><span class="comment">&#123;压栈&#125;</span></span><br><span class="line">        <span class="keyword">case</span> Look <span class="keyword">of</span></span><br><span class="line">        <span class="string">&#x27;+&#x27;</span>: <span class="keyword">Add</span><span class="punctuation">;</span><span class="comment">&#123;Match(&#x27;+&#x27;);Term; ADD (SP)+,D0;&#125;</span></span><br><span class="line">        <span class="string">&#x27;-&#x27;</span>: Substract<span class="punctuation">;</span><span class="comment">&#123;Match(&#x27;-&#x27;);Term; SUB (SP)-,D0; NEG D0;&#125;</span></span><br><span class="line">        <span class="keyword">else</span> Expected(<span class="string">&#x27;加减操作符&#x27;</span>)<span class="punctuation">;</span></span><br><span class="line">        <span class="keyword">end</span><span class="punctuation">;</span></span><br><span class="line">    <span class="keyword">end</span><span class="punctuation">;</span></span><br><span class="line"><span class="keyword">end</span><span class="punctuation">;</span></span><br></pre></td></tr></table></figure>


<h1 id="阶段2-Assignment（name-expression，多位数和标识符Token识别）"><a href="#阶段2-Assignment（name-expression，多位数和标识符Token识别）" class="headerlink" title="阶段2 Assignment（name &#x3D; expression，多位数和标识符Token识别）"></a>阶段2 Assignment（name &#x3D; expression，多位数和标识符Token识别）</h1><h2 id="增加-单个字母的标识符（以及无参的函数调用C语言格式）"><a href="#增加-单个字母的标识符（以及无参的函数调用C语言格式）" class="headerlink" title="增加 单个字母的标识符（以及无参的函数调用C语言格式）"></a>增加 单个字母的标识符（以及无参的函数调用C语言格式）</h2><figure class="highlight delphi"><table><tr><td class="code"><pre><span class="line"><span class="comment">&#123;</span></span><br><span class="line"><span class="comment">    factor ::= GetNum | (expre) | Ident</span></span><br><span class="line"><span class="comment">    Ident ::= GetName &lt;&#x27;(&#x27;&#x27;)&#x27;&gt;</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">&#123;-------------------------------------------&#125;</span></span><br><span class="line"><span class="function"><span class="keyword">procedure</span> <span class="title">Factor</span>;</span></span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">if</span> Look =<span class="string">&#x27;(&#x27;</span> than <span class="keyword">begin</span></span><br><span class="line">        Match(<span class="string">&#x27;(&#x27;</span>);</span><br><span class="line">        Expression;</span><br><span class="line">        Match(<span class="string">&#x27;)&#x27;</span>);</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> IsAlpha(Look) <span class="keyword">then</span> <span class="keyword">begin</span></span><br><span class="line">        Ident;<span class="comment">&#123;标识符识别&#125;</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">       EmitLn(<span class="string">&#x27;MOVE&#x27;</span>+#GetNum+<span class="string">&#x27;,D0&#x27;</span>);</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">&#123;----------------------------------------&#125;</span></span><br><span class="line"><span class="function"><span class="keyword">procedure</span> <span class="title">Ident</span>;</span></span><br><span class="line"><span class="keyword">var</span> <span class="keyword">Name</span>:Char;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">Name</span> :=GetName;</span><br><span class="line">    <span class="keyword">if</span> Look = <span class="string">&#x27;(&#x27;</span> <span class="keyword">then</span></span><br><span class="line">        <span class="keyword">begin</span></span><br><span class="line">        Match(<span class="string">&#x27;(&#x27;</span>);</span><br><span class="line">        Match(<span class="string">&#x27;)&#x27;</span>);</span><br><span class="line">        EmitLn(<span class="string">&#x27;BSR &#x27;</span>+<span class="keyword">Name</span>);<span class="comment">&#123;调用函数&#125;</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">else</span> EmitLn(<span class="string">&#x27;MOVE &#x27;</span>+<span class="keyword">Name</span>+<span class="string">&#x27;(PC),D0&#x27;</span>);<span class="comment">&#123;将操作数取出来放在D0&#125;</span></span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="增加赋值语句"><a href="#增加赋值语句" class="headerlink" title="增加赋值语句"></a>增加赋值语句</h2><figure class="highlight delphi"><table><tr><td class="code"><pre><span class="line"><span class="comment">&#123;</span></span><br><span class="line"><span class="comment">    Assignment ::= GetName = expr</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="function"><span class="keyword">procedure</span> <span class="title">Assignment</span>;</span></span><br><span class="line"><span class="keyword">var</span> <span class="keyword">Name</span>:char;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">Name</span>:=GetName;</span><br><span class="line">    Match(<span class="string">&#x27;=&#x27;</span>);</span><br><span class="line">    Expression;</span><br><span class="line">    <span class="comment">&#123;赋值汇编&#125;</span></span><br><span class="line">    EmitLn(<span class="string">&#x27;LEA &#x27;</span>+<span class="keyword">Name</span>+<span class="string">&#x27;(PC)&#x27;</span>,A0);<span class="comment">&#123;A0是地址寄存器，存放Name的地址，PC相对寻址&#125;</span></span><br><span class="line">    EmitLn(<span class="string">&#x27;MOVE D0,(A0)&#x27;</span>);</span><br><span class="line"><span class="keyword">end</span>;</span><br></pre></td></tr></table></figure>
<h2 id="增加多位数和多个字母"><a href="#增加多位数和多个字母" class="headerlink" title="增加多位数和多个字母"></a>增加多位数和多个字母</h2><figure class="highlight gml"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    GetNum，GetName重写<span class="keyword">while</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> GetNum:<span class="built_in">string</span>;</span><br><span class="line"><span class="keyword">var</span> Value:<span class="built_in">string</span>;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">    Value:=<span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> isDigit(Look) <span class="keyword">then</span> Expected(<span class="string">&#x27;Digit&#x27;</span>);</span><br><span class="line">    <span class="keyword">while</span> isDigit(Look) <span class="keyword">do</span> <span class="keyword">begin</span></span><br><span class="line">        Value:=Value+Look;</span><br><span class="line">        GetChar;</span><br><span class="line">    <span class="keyword">end</span>;</span><br><span class="line"><span class="keyword">end</span>;</span><br></pre></td></tr></table></figure>

<h2 id="增加空格过滤"><a href="#增加空格过滤" class="headerlink" title="增加空格过滤"></a>增加空格过滤</h2><figure class="highlight hy"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    识别空格，过滤空格，保证其余的识别开头第一个是非空格字符，即：</span><br><span class="line"></span><br><span class="line">    Init 中GetChar后要SkipWhite；</span><br><span class="line"></span><br><span class="line">    GetNum/Name 最后要SkipWhite;</span><br><span class="line">    </span><br><span class="line">    tips: LR (<span class="name">#10</span>,<span class="comment">^J</span>) CR($<span class="number">13</span>,<span class="comment">^M</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Compiler</category>
      </categories>
      <tags>
        <tag>turbo pascal</tag>
        <tag>68000 Assembly</tag>
        <tag>Jack W. Crenshaw</tag>
        <tag>compiler</tag>
      </tags>
  </entry>
</search>
